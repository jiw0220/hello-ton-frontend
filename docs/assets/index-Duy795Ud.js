var P=Object.defineProperty;var W=(i,t,n)=>t in i?P(i,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[t]=n;var v=(i,t,n)=>(W(i,typeof t!="symbol"?t+"":t,n),n);import{i as k,t as H,m as A,d as T,o as x,c as L,a as h,w as p,u as f,b as M,e as b,f as _,B as w,_ as $}from"./index-CX5aP-84.js";function D(){const i=k(A,null);return i===null&&H("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),i}const F="https://dashboard.edgematrix.pro/",O="#auth",z=500,G="authorize-ready",V="authorize-setup",K="authorize-success",B="authorize-failure",j="user-interrupt";class q{constructor(){v(this,"_emcWindow");v(this,"_eventHandler")}_removeEventListener(){this._eventHandler&&window.removeEventListener("message",this._eventHandler),this._eventHandler=void 0}_getEventHandler(t,n){return async a=>{var l;if(a.origin!==t.origin){console.warn(`expected origin '${t.origin}', got '${a.origin}'`);return}const d=a.data;switch(d.type){case G:{const u={type:V};(l=this._emcWindow)==null||l.postMessage(u,t.origin);break}case K:try{await this._handleSuccess(d,n.onSuccess)}catch(u){this._handleFailure(u.message,n.onError)}break;case B:this._handleFailure(d.data,n.onError);break;default:console.info(`unknow message type '${d.type}'`);break}}}async _handleSuccess(t,n){this._emcWindow&&this._emcWindow.close(),this._removeEventListener(),delete this._emcWindow,typeof n=="function"&&n(t)}_handleFailure(t,n){this._emcWindow&&!this._emcWindow.closed&&this._emcWindow.close(),typeof n=="function"&&n(t),this._removeEventListener(),delete this._emcWindow}signIn(t){const n=new URL(t.provider||F);n.hash=t.endpoint||O,this._emcWindow&&this._emcWindow.close(),this._removeEventListener(),this._eventHandler=this._getEventHandler(n,t),window.addEventListener("message",this._eventHandler),this._emcWindow=window.open(n.toString(),"emcWindow",t.windowOpenerFeatures);const a=()=>{this._emcWindow&&(this._emcWindow.closed?this._handleFailure(j,t.onError):setTimeout(a,z))};a()}}const Q=new q,y="https://emchub.ai/";function Y(){function i(e){const o=new URLSearchParams;return Object.entries(e).forEach(([s,r])=>{o.append(s,r)}),o.toString()}function t(e){return typeof e!="string"?"":typeof decodeURIComponent!="function"||typeof encodeURIComponent!="function"||decodeURIComponent(e)!==e?e:encodeURIComponent(e)}function n(e){return new Promise(o=>{const s=e.provider||y,r=e.endpoint||"#/auth",c=e.windowOpenerFeatures||"popup,width=480,height=720",m=e.client,E=t(e.redirect||"0"),g=e.scope||"read",R=i({launch:"popup",client:m,redirect:E,scope:g}),I=r.indexOf("?")>-1?"&":"?",C=`${r}${I}${R}`,U=S=>o(["",S.data]),N=S=>o([S,null]);if(!m)throw new Error("Invalid 'client'");Q.signIn({provider:s,endpoint:C,windowOpenerFeatures:c,onSuccess:U,onError:N})})}async function a(e){if(typeof window>"u")return["Not found window",null];if(!window.location)return["Not found window.location",null];try{const o=e.provider||y,s=e.endpoint||"#/auth",r=e.client,c=t(e.redirect),m=e.scope||"read",E=e.state||"",g=new URL(o),R=i({launch:"redirect",client:r,redirect:c,scope:m,state:E}),I=s.indexOf("?")>-1?"&":"?";if(g.hash=`${s}${I}${R}`,!r)throw new Error("Invalid 'client'");if(!c)throw new Error("Invalid 'redirect'");return["",{url:g.toString()}]}catch(o){return console.error("Error sign in redirect",o),[o.message,null]}}function d(e,o){let s=new RegExp(`[?&]${e}=([^&?#/]+)`,"g"),r=null,c=[];for(;(r=s.exec(o))!==null;)c.push(r[1]);return c}function l(e,o){const s=d(e,o);return s[s.length-1]}async function u(){const e=l("code",location.href);return e?["",{code:e}]:["Not found 'code' value",null]}return{signInWithPopup:n,signInWithRedirect:a,getRedirectResult:u}}const{signInWithPopup:J,signInWithRedirect:X,getRedirectResult:Z}=Y(),ee={class:"page"},te=T({__name:"index",setup(i){async function t(){const o={client:"1234"},[s,r]=await J(o);if(s)return window.alert(s);const c=r.code;window.alert(`code: ${c}`)}async function n(){const o={client:"1234",redirect:location.href};sessionStorage.setItem("redrect","1");const[s,r]=await X(o);if(s)return window.alert(s);location.href=r.url}x(async()=>{if(sessionStorage.getItem("redrect")){sessionStorage.removeItem("redrect");const[s,r]=await Z();if(s)return window.alert(s);const c=r.code;window.alert(`code: ${c}`)}});const a=M(),d=D();function l(){a.push({name:"test"})}function u(){sessionStorage.setItem("kk","hello?")}function e(){const o=sessionStorage.getItem("kk");d.info(o||"none")}return(o,s)=>(b(),L("div",ee,[h(f(w),{type:"primary",size:"large",strong:"",onClick:l},{default:p(()=>[_("Go Next Page")]),_:1}),h(f(w),{type:"primary",size:"large",strong:"",onClick:t},{default:p(()=>[_("Go EMC Hub Popup")]),_:1}),h(f(w),{type:"primary",size:"large",strong:"",onClick:n},{default:p(()=>[_("Go EMC Hub Redirect")]),_:1}),h(f(w),{type:"primary",size:"large",strong:"",onClick:u},{default:p(()=>[_("Set Session Storage")]),_:1}),h(f(w),{type:"primary",size:"large",strong:"",onClick:e},{default:p(()=>[_("Get Session Storage")]),_:1})]))}}),se=$(te,[["__scopeId","data-v-f8ed386b"]]);export{se as default};
